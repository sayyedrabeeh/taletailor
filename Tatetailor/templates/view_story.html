{% load static %}
<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Story Viewer - TALETAILOR</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
  <link rel="icon" type="image/png" href="static/images/fav.jpg">

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link
    href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&family=Playfair+Display:ital,wght@0,600;1,600&display=swap"
    rel="stylesheet">

  <style>
    :root {
      /* Base Colors */
      --primary-color: #6d28d9;
      --secondary-color: #10b981;
      --accent-color: #db2777;
      --background-color: #0f172a;
      --card-background: #1e293b;
      --text-color: #f1f5f9;
      --text-muted: #94a3b8;
      --border-color: rgba(255, 255, 255, 0.1);

      /* Gradients */
      --header-gradient: linear-gradient(135deg, var(--primary-color), var(--accent-color));
      --glass-bg: rgba(30, 41, 59, 0.7);

      /* Legacy support & Animations */
      --glow-color: rgba(109, 40, 217, 0.5);
      --particle-color: #a855f7;
      --button-hover: #7c3aed;
      --button-glow: rgba(124, 58, 237, 0.5);

      /* Spacing & Layout */
      --border-radius: 16px;
      --shadow-sm: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
      --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05);
      --shadow-glow: 0 0 20px rgba(109, 40, 217, 0.3);
      --shadow: 0 8px 32px 0 rgba(31, 38, 135, 0.37);
      --joker-purple: linear-gradient(135deg, #a855f7 0%, #6d28d9 100%);
      --joker-green: #10b981;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: 'Outfit', sans-serif;
    }

    body {
      background-color: var(--background-color);
      color: var(--text-color);
      line-height: 1.6;
      background-image:
        radial-gradient(circle at 15% 50%, rgba(109, 40, 217, 0.15), transparent 25%),
        radial-gradient(circle at 85% 30%, rgba(219, 39, 119, 0.15), transparent 25%);
      background-attachment: fixed;
    }

    /* Layout Containers */
    .story-container {
      max-width: 1280px;
      margin: 3rem auto;
      display: grid;
      grid-template-columns: 1fr 340px;
      gap: 2.5rem;
      padding: 0 1.5rem;
    }

    /* Main Story Card */
    .story-main {
      background-color: var(--card-background);
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-lg);
      overflow: hidden;
      border: 1px solid var(--border-color);
      position: relative;
    }

    /* Header Section */
    .story-header {
      background: linear-gradient(to bottom, rgba(15, 23, 42, 0.8), var(--card-background)),
      url('static/images/pattern.png');
      padding: 3rem;
      position: relative;
    }

    .story-header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 4px;
      background: var(--header-gradient);
    }

    .story-title {
      font-family: 'Playfair Display', serif;
      font-size: 3rem;
      font-weight: 700;
      line-height: 1.2;
      margin-bottom: 1rem;
      color: var(--text-color);
    }

    .story-author {
      font-size: 1.1rem;
      color: var(--text-muted);
      margin-bottom: 2rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .story-author a {
      color: var(--secondary-color);
      font-weight: 600;
      transition: color 0.2s;
    }

    .story-author a:hover {
      color: #34d399;
    }

    /* Meta Info Grid */
    .story-meta {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      border-top: 1px solid var(--border-color);
      padding-top: 1.5rem;
    }

    .meta-item {
      display: flex;
      align-items: center;
      gap: 0.6rem;
      background: rgba(255, 255, 255, 0.03);
      padding: 0.6rem 1.2rem;
      border-radius: 50px;
      font-size: 0.9rem;
      color: var(--text-muted);
      border: 1px solid var(--border-color);
      transition: all 0.2s ease;
    }

    .meta-item:hover {
      background: rgba(255, 255, 255, 0.08);
      transform: translateY(-2px);
      border-color: rgba(255, 255, 255, 0.2);
    }

    .meta-item i {
      color: var(--secondary-color);
    }

    /* Story Content */
    .story-image {
      width: 100%;
      height: 450px;
      object-fit: cover;
      display: block;
    }

    .story-content {
      padding: 3rem 3rem 4rem;
      font-size: 1.15rem;
      line-height: 1.9;
      color: var(--text-color);
    }

    .story-content p {
      margin-bottom: 1.5rem;
    }

    /* Sidebar Components */
    .story-sidebar {
      display: flex;
      flex-direction: column;
      gap: 2rem;
    }

    .action-card {
      background: var(--card-background);
      border-radius: var(--border-radius);
      border: 1px solid var(--border-color);
      overflow: hidden;
      box-shadow: var(--shadow-sm);
    }

    .card-header {
      padding: 1.2rem 1.5rem;
      background: rgba(255, 255, 255, 0.02);
      border-bottom: 1px solid var(--border-color);
      font-weight: 600;
      color: var(--text-color);
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .card-content {
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.75rem;
      padding: 0.75rem 1.5rem;
      border-radius: 12px;
      font-weight: 600;
      cursor: pointer;
      border: none;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
      overflow: hidden;
    }

    .btn i {
      font-size: 1.1em;
    }

    .download-btn {
      background: var(--secondary-color);
      color: #000;
    }

    .download-btn:hover {
      filter: brightness(110%);
      box-shadow: 0 0 15px rgba(16, 185, 129, 0.4);
    }

    .share-btn {
      background: var(--primary-color) !important;
      color: white !important;
    }

    .share-btn:hover {
      filter: brightness(110%);
      box-shadow: 0 0 15px var(--button-glow);
    }

    .like-btn {
      background: #dc2626;
      color: black;
    }

    .like-btn:hover {
      background: #ef4444;
      box-shadow: 0 0 15px rgba(220, 38, 38, 0.4);
    }

    /* Info List */
    .info-item {
      display: flex;
      align-items: flex-start;
      gap: 1rem;
      padding: 1rem 0;
      border-bottom: 1px solid var(--border-color);
    }

    .info-item:last-child {
      border-bottom: none;
    }

    .info-icon {
      width: 42px;
      height: 42px;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 10px;
      display: grid;
      place-items: center;
      color: var(--secondary-color);
      flex-shrink: 0;
    }

    .info-content {
      display: flex;
      flex-direction: column;
    }

    .info-label {
      font-size: 0.75rem;
      text-transform: uppercase;
      letter-spacing: 1px;
      color: var(--text-muted);
      margin-bottom: 0.25rem;
    }

    .info-value {
      font-weight: 500;
    }

    /* Tags */
    .tags-container {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.5rem;
    }

    .tag {
      background: rgba(109, 40, 217, 0.15);
      color: #d8b4fe;
      padding: 0.25rem 0.75rem;
      border-radius: 6px;
      font-size: 0.85rem;
      font-weight: 500;
      border: 1px solid rgba(109, 40, 217, 0.3);
      transition: all 0.2s;
    }

    .tag:hover {
      background: var(--primary-color);
      color: white;
    }

    /* Similar Stories */
    .similar-story {
      display: flex;
      align-items: center;
      gap: 1rem;
      padding: 0.75rem;
      border-radius: 10px;
      transition: background 0.2s;
    }

    .similar-story:hover {
      background: rgba(255, 255, 255, 0.05);
    }

    .similar-story-img {
      width: 56px;
      height: 56px;
      border-radius: 8px;
      object-fit: cover;
    }

    .similar-story-info h5 {
      font-weight: 600;
      margin-bottom: 0.25rem;
      color: var(--text-color);
    }

    .similar-story-info span {
      font-size: 0.8rem;
      color: var(--text-muted);
    }

    /* Responsive */
    @media (max-width: 900px) {
      .story-container {
        grid-template-columns: 1fr;
      }

      .story-header,
      .story-content {
        padding: 2rem;
      }

      .story-title {
        font-size: 2.25rem;
      }
    }



    /* Dark mode preference */
    @media (prefers-color-scheme: dark) {

      /* Default to dark theme if user prefers dark mode and no theme is selected */
      body:not([class*="theme-"]) {
        --primary-color: #4a0e5c;
        --secondary-color: #1fc55c;
        --accent-color: #8a0e74;
        --background-color: #121212;
        --card-background: #1e1e1e;
        --text-color: #e0e0e0;
        --light-gray: #333333;
        --header-gradient: linear-gradient(135deg, #4a0e5c, #8a0e74);
        --button-hover: #17a44a;
        --button-glow: rgba(31, 197, 92, 0.4);
      }
    }

    .volume-btn {
      background-color: #f3f3f3;
      border: none;
      padding: 5px 10px;
      cursor: pointer;
      font-size: 18px;
      border-radius: 5px;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .volume-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      min-width: 38px;
      height: 38px;
      padding: 0 10px;
      background-color: #f0f0f0;
      border: 1px solid #ccc;
      border-radius: 4px;
      cursor: pointer;
      transition: all 0.2s ease;
      position: relative;
    }

    .volume-btn:hover {
      background-color: #e0e0e0;
    }

    .volume-btn.speaking {
      background-color: #ffecec;
      border-color: #ff6b6b;
    }

    .volume-btn.limited-support {
      background-color: #fff9e6;
      border-color: #ffc107;
    }

    .volume-btn.limited-support:hover::after {
      content: "This language has limited support. Text may not be read correctly.";
      position: absolute;
      top: 100%;
      left: 50%;
      transform: translateX(-50%);
      margin-top: 5px;
      width: 200px;
      background-color: #fff;
      border: 1px solid #ccc;
      border-radius: 4px;
      padding: 8px;
      font-size: 12px;
      color: #333;
      text-align: center;
      z-index: 1000;
      box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
    }

    .homebtn {
      display: inline-block;
      padding: 6px 10px;
      background-color: #007BFF;
      color: white;
      text-decoration: none;
      border-radius: 6px;
      font-size: 18px;
      line-height: 1;
      width: 70px;
      font-weight: bold;
    }

    .homebtn:hover {
      background-color: #0056b3;
    }

    /* Add a fade-in animation */
    @keyframes fadeIn {
      from {
        opacity: 0;
      }

      to {
        opacity: 1;
      }
    }

    .home-btn {
      position: fixed;
      top: 20px;
      left: 20px;
      background: var(--joker-purple);
      color: white;
      padding: 10px 16px;
      border-radius: 6px;
      text-decoration: none;
      font-weight: bold;
      box-shadow: var(--shadow);
      transition: all 0.3s ease;
      z-index: 1000;
    }

    .home-btn:hover {
      background-color: var(--accent-color);
    }

    .volume-btn.limited-support:hover::after {
      animation: fadeIn 0.2s ease-out;
    }

    a,
    a:visited {
      color: inherit;
      text-decoration: none;
    }

    /* ===========================
       LAYOUT & VISUAL EFFECTS
       =========================== */

    /* Advanced Card Styling with Gradients */
    .story-main {
      background: var(--card-background);
      border-top: 4px solid transparent;
      border-image: var(--header-gradient) 1;
      position: relative;
      overflow: hidden;
      box-shadow:
        0 10px 40px rgba(0, 0, 0, 0.2),
        0 0 0 1px rgba(255, 255, 255, 0.1) inset;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .story-main::before {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg,
          transparent 0%,
          rgba(255, 255, 255, 0.1) 50%,
          transparent 100%);
    }

    .story-main:hover::before {
      animation: shine 3s infinite;
    }

    .story-main:hover {
      transform: translateY(-8px) scale(1.01);
      box-shadow:
        0 20px 60px rgba(0, 0, 0, 0.3),
        0 0 0 1px rgba(255, 255, 255, 0.2) inset,
        0 0 40px var(--glow-color);
    }

    /* Extraordinary Header with Multiple Gradient Layers */
    .story-header {
      background: var(--header-gradient);
      position: relative;
      overflow: hidden;
      padding: 3rem 2rem;
    }

    .story-header::before {
      content: "";
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background:
        radial-gradient(circle at 20% 50%, rgba(255, 255, 255, 0.2) 0%, transparent 50%),
        radial-gradient(circle at 80% 50%, rgba(255, 255, 255, 0.15) 0%, transparent 50%);
      animation: float-orbs 8s ease-in-out infinite;
    }

    .story-header::after {
      content: "";
      position: absolute;
      bottom: -2px;
      left: 0;
      right: 0;
      height: 100px;
      background: linear-gradient(180deg, transparent 0%, var(--background-color) 100%);
    }

    /* Animated Gradient Border Effect */
    .action-card {
      background: var(--card-background);
      border: 2px solid transparent;
      background-clip: padding-box;
      position: relative;
      overflow: hidden;
      box-shadow:
        0 8px 32px rgba(0, 0, 0, 0.2),
        0 0 0 1px rgba(255, 255, 255, 0.05) inset;
    }

    .action-card::before {
      content: "";
      position: absolute;
      top: -2px;
      left: -2px;
      right: -2px;
      bottom: -2px;
      background: var(--header-gradient);
      border-radius: inherit;
      z-index: -1;
      opacity: 0.8;
      animation: rotate-border 4s linear infinite;
    }

    .action-card::after {
      content: "";
      position: absolute;
      inset: 0;
      background: var(--card-background);
      border-radius: inherit;
      z-index: -1;
    }

    /* Glassmorphism Effect for Buttons */
    .btn {
      background: linear-gradient(135deg,
          rgba(255, 255, 255, 0.2) 0%,
          rgba(255, 255, 255, 0.05) 100%);
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.3);
      box-shadow:
        0 4px 16px rgba(0, 0, 0, 0.2),
        0 0 0 1px rgba(255, 255, 255, 0.1) inset;
      position: relative;
      overflow: hidden;
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .btn::before {
      content: "";
      position: absolute;
      top: 50%;
      left: 50%;
      width: 0;
      height: 0;
      border-radius: 50%;
      background: radial-gradient(circle, rgba(255, 255, 255, 0.4) 0%, transparent 70%);
      transform: translate(-50%, -50%);
      transition: width 0.6s, height 0.6s;
    }

    .btn:hover::before {
      width: 300px;
      height: 300px;
    }

    .btn:hover {
      transform: translateY(-4px);
      box-shadow:
        0 12px 32px rgba(0, 0, 0, 0.3),
        0 0 0 1px rgba(255, 255, 255, 0.2) inset,
        0 0 30px var(--glow-color);
    }

    /* Particle Background System */
    body::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image:
        radial-gradient(circle at 10% 20%, var(--particle-color) 0px, transparent 1px),
        radial-gradient(circle at 90% 80%, var(--particle-color) 0px, transparent 1px),
        radial-gradient(circle at 50% 50%, var(--particle-color) 0px, transparent 1px),
        radial-gradient(circle at 30% 70%, var(--particle-color) 0px, transparent 1px),
        radial-gradient(circle at 70% 30%, var(--particle-color) 0px, transparent 1px);
      background-size: 200px 200px;
      opacity: 0.3;
      animation: particle-drift 60s linear infinite;
      pointer-events: none;
      z-index: -1;
    }

    /* Mesh Gradient Background for Body */
    body {
      background: var(--background-color);
      position: relative;
    }

    body::after {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background:
        radial-gradient(ellipse at top left, var(--glow-color) 0%, transparent 50%),
        radial-gradient(ellipse at bottom right, var(--glow-color) 0%, transparent 50%),
        radial-gradient(ellipse at top right, rgba(255, 255, 255, 0.1) 0%, transparent 40%);
      opacity: 0.4;
      pointer-events: none;
      z-index: -1;
      animation: mesh-flow 20s ease-in-out infinite;
    }

    /* Advanced Tag Styling */
    .tag {
      background: linear-gradient(135deg,
          rgba(255, 255, 255, 0.1) 0%,
          rgba(255, 255, 255, 0.05) 100%);
      backdrop-filter: blur(8px);
      border: 1px solid rgba(255, 255, 255, 0.2);
      border-left: 3px solid var(--primary-color);
      box-shadow:
        0 2px 8px rgba(0, 0, 0, 0.15),
        0 0 0 1px rgba(255, 255, 255, 0.1) inset;
      position: relative;
      overflow: hidden;
    }

    .tag::before {
      content: "";
      position: absolute;
      top: 0;
      left: -100%;
      width: 100%;
      height: 100%;
      background: linear-gradient(90deg,
          transparent 0%,
          rgba(255, 255, 255, 0.2) 50%,
          transparent 100%);
      transition: left 0.5s;
    }

    .tag:hover::before {
      left: 100%;
    }

    .tag:hover {
      background: var(--header-gradient);
      color: white;
      transform: translateY(-2px);
      box-shadow: 0 4px 16px var(--glow-color);
    }

    /* Animated Info Icons with Gradient */
    .info-icon {
      background: var(--header-gradient);
      box-shadow:
        0 4px 12px rgba(0, 0, 0, 0.2),
        0 0 0 2px rgba(255, 255, 255, 0.1) inset;
      position: relative;
      overflow: hidden;
    }

    .info-icon::before {
      content: "";
      position: absolute;
      inset: -100%;
      background: conic-gradient(from 0deg,
          transparent 0deg,
          rgba(255, 255, 255, 0.3) 90deg,
          transparent 180deg);
      animation: icon-spin 3s linear infinite;
    }

    /* Holographic Effect for Images */
    .story-image {
      position: relative;
      filter: saturate(1.2) contrast(1.1);
    }

    .story-image::before {
      content: "";
      position: absolute;
      inset: 0;
      background: linear-gradient(135deg,
          rgba(255, 255, 255, 0.1) 0%,
          transparent 50%,
          rgba(255, 255, 255, 0.1) 100%);
      opacity: 0;
      transition: opacity 0.4s;
      pointer-events: none;
    }

    .story-main:hover .story-image::before {
      opacity: 1;
    }

    /* Dynamic Shadow System */
    .similar-story {
      transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
      position: relative;
    }

    .similar-story::before {
      content: "";
      position: absolute;
      left: 0;
      top: 0;
      bottom: 0;
      width: 3px;
      background: var(--header-gradient);
      transform: scaleY(0);
      transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
    }

    .similar-story:hover::before {
      transform: scaleY(1);
    }

    .similar-story:hover {
      background: linear-gradient(90deg,
          rgba(255, 255, 255, 0.05) 0%,
          transparent 100%);
      transform: translateX(10px);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
    }

    /* Extraordinary Animations */
    @keyframes gradient-flow {
      0% {
        background-position: 0% 50%;
      }

      50% {
        background-position: 100% 50%;
      }

      100% {
        background-position: 0% 50%;
      }
    }

    @keyframes shine {
      0% {
        left: -100%;
      }

      100% {
        left: 200%;
      }
    }

    @keyframes float-orbs {

      0%,
      100% {
        transform: translate(0, 0) scale(1);
        opacity: 0.6;
      }

      50% {
        transform: translate(20px, -20px) scale(1.1);
        opacity: 0.8;
      }
    }

    @keyframes rotate-border {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    @keyframes particle-drift {
      0% {
        transform: translate(0, 0);
      }

      100% {
        transform: translate(50px, 50px);
      }
    }

    @keyframes mesh-flow {

      0%,
      100% {
        transform: scale(1) translate(0, 0);
        opacity: 0.3;
      }

      50% {
        transform: scale(1.1) translate(20px, 20px);
        opacity: 0.5;
      }
    }

    @keyframes icon-spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    /* Responsive Adjustments */
    @media (max-width: 768px) {
      .story-header {
        padding: 2rem 1.5rem;
      }

      .story-main::before {
        animation: shine 5s infinite;
      }
    }

    /* Accessibility */
    @media (prefers-reduced-motion: reduce) {
      * {
        animation-duration: 0.01ms !important;
        animation-iteration-count: 1 !important;
        transition-duration: 0.01ms !important;
      }
    }

    /* ===========================
       TRANSLATION BAR & FORM ELEMENTS
       =========================== */

    .translation-box {
      background: var(--glass-bg);
      backdrop-filter: blur(15px);
      border: 1px solid var(--border-color);
      border-radius: var(--border-radius);
      padding: 1.5rem 2rem;
      margin: 2rem 0;
      display: flex;
      flex-direction: column;
      gap: 1.25rem;
      box-shadow: var(--shadow);
      position: relative;
      z-index: 10;
    }

    .translation-form {
      display: flex;
      flex-wrap: wrap;
      gap: 1.5rem;
      align-items: center;
      width: 100%;
    }

    .translation-box label {
      font-weight: 600;
      color: var(--text-color);
      font-size: 1rem;
      white-space: nowrap;
    }

    .select-wrapper {
      flex: 1;
      min-width: 250px;
      position: relative;
    }

    .translation-box select,
    .select-language {
      width: 100%;
      padding: 0.8rem 1.2rem;
      border: 1px solid var(--border-color);
      border-radius: 12px;
      background: rgba(255, 255, 255, 0.05);
      color: var(--text-color);
      font-size: 1rem;
      font-family: 'Outfit', sans-serif;
      transition: all 0.3s ease;
      cursor: pointer;
    }

    .translation-box select:focus,
    .select-language:focus {
      outline: none;
      border-color: var(--primary-color);
      background: rgba(255, 255, 255, 0.08);
      box-shadow: 0 0 0 4px rgba(109, 40, 217, 0.15);
    }

    .translate-submit-btn {
      padding: 0.8rem 2.5rem;
      background: var(--header-gradient);
      color: white;
      border: none;
      border-radius: 12px;
      font-weight: 700;
      font-size: 1rem;
      cursor: pointer;
      transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
      font-family: 'Outfit', sans-serif;
      box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
    }

    .translate-submit-btn:hover {
      transform: translateY(-3px) scale(1.02);
      box-shadow: 0 8px 25px var(--button-glow);
      filter: brightness(110%);
    }

    #language-support-notification {
      background: rgba(255, 193, 7, 0.1) !important;
      border: 1px solid rgba(255, 193, 7, 0.3) !important;
      padding: 1rem 1.25rem !important;
      border-radius: 12px !important;
      display: flex;
      align-items: center;
      gap: 0.75rem;
      animation: fadeIn 0.4s ease-out;
    }

    #language-support-notification p {
      margin: 0;
      color: #ffc107;
      font-size: 0.95rem;
    }

    /* Select2 Overrides */
    .select2-container--default .select2-selection--single {
      background: var(--card-background) !important;
      border: 1px solid var(--border-color) !important;
      border-radius: 8px !important;
      height: 45px !important;
      padding: 0.5rem !important;
    }

    .select2-container--default .select2-selection--single .select2-selection__rendered {
      color: var(--text-color) !important;
      line-height: 30px !important;
    }

    .select2-container--default .select2-selection--single .select2-selection__arrow {
      height: 43px !important;
    }

    .select2-dropdown {
      background: var(--card-background) !important;
      border: 1px solid var(--border-color) !important;
      border-radius: 8px !important;
    }

    .select2-results__option {
      color: var(--text-color) !important;
      padding: 0.75rem 1rem !important;
    }

    .select2-results__option--highlighted {
      background: var(--primary-color) !important;
      color: white !important;
    }

    /* ===========================
       COMMENT SECTION
       =========================== */

    .comments-section {
      max-height: 400px;
      overflow-y: auto;
      padding: 1rem;
      background: var(--card-background);
      border-radius: var(--border-radius);
      margin-bottom: 1.5rem;
    }

    .comments-section::-webkit-scrollbar {
      width: 8px;
    }

    .comments-section::-webkit-scrollbar-track {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 4px;
    }

    .comments-section::-webkit-scrollbar-thumb {
      background: var(--primary-color);
      border-radius: 4px;
    }

    .comment-item {
      padding: 1rem;
      border-radius: 8px;
      margin-bottom: 0.75rem;
      background: rgba(255, 255, 255, 0.03);
      border: 1px solid var(--border-color);
      transition: all 0.2s ease;
    }

    .comment-item:hover {
      background: rgba(255, 255, 255, 0.06);
      border-color: var(--primary-color);
    }

    .comment-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .comment-author {
      font-weight: 600;
      color: var(--secondary-color);
      text-decoration: none;
      transition: color 0.2s;
      font-size: 0.95rem;
    }

    .comment-author:hover {
      color: var(--primary-color);
      text-decoration: underline;
    }

    .comment-date {
      font-size: 0.85rem;
      color: var(--text-muted);
    }

    .comment-content {
      color: var(--text-color);
      line-height: 1.6;
      margin: 0.5rem 0;
    }

    .comment-form {
      background: var(--card-background);
      border: 1px solid var(--border-color);
      padding: 1.5rem;
      border-radius: var(--border-radius);
      box-shadow: var(--shadow-sm);
    }

    .comment-form textarea {
      width: 100%;
      padding: 1rem;
      border: 1px solid var(--border-color);
      border-radius: 8px;
      background: rgba(255, 255, 255, 0.03);
      color: var(--text-color);
      resize: vertical;
      min-height: 100px;
      font-family: 'Outfit', sans-serif;
      font-size: 0.95rem;
      margin-bottom: 1rem;
      transition: all 0.2s ease;
    }

    .comment-form textarea:focus {
      outline: none;
      border-color: var(--primary-color);
      box-shadow: 0 0 0 3px rgba(109, 40, 217, 0.1);
      background: rgba(255, 255, 255, 0.05);
    }

    .comment-form textarea::placeholder {
      color: var(--text-muted);
    }

    .comment-form button[type="submit"] {
      background: var(--primary-color);
      color: white;
      padding: 0.75rem 2rem;
      border: none;
      border-radius: 8px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: 'Outfit', sans-serif;
    }

    .comment-form button[type="submit"]:hover {
      background: var(--button-hover);
      transform: translateY(-2px);
      box-shadow: 0 4px 12px var(--button-glow);
    }

    .delete-comment-btn {
      background: none;
      border: none;
      color: #ef4444;
      cursor: pointer;
      padding: 0.25rem 0.5rem;
      border-radius: 4px;
      transition: all 0.2s ease;
    }

    .delete-comment-btn:hover {
      background: rgba(239, 68, 68, 0.1);
      color: #dc2626;
    }

    /* AI Badge */
    .ai-badge {
      background: linear-gradient(135deg, #f59e0b, #d97706);
      color: white;
      padding: 0.35rem 0.75rem;
      border-radius: 6px;
      font-size: 0.8rem;
      font-weight: 600;
      margin-left: 1rem;
      box-shadow: 0 2px 8px rgba(245, 158, 11, 0.3);
    }

    /* ===========================
       ULTRA PROFESSIONAL THEMES
       High-End Visual Experiences
       =========================== */

    /* Happy: "Soothing Sunny" - Warm, Optimistic, Highly Readable */
    .theme-happy {
      --primary-color: #f59e0b;
      /* Amber 500 */
      --secondary-color: #0369a1;
      /* Sky Blue 700 (Better for Links) */
      --accent-color: #b45309;
      /* Amber 700 */
      --background-url: none;
      --background-color: #fef9c3;
      /* Soothing Sunlight Yellow (Yellow 100) */
      --card-background: #fffdfa;
      /* Warm Creamy White */

      --text-color: #020617;
      /* Absolute Readability (Near Black) */
      --text-muted: #131721;
      /* Deep Charcoal */
      --border-color: rgba(245, 158, 11, 0.2);

      --header-gradient: linear-gradient(135deg, #fbbf24 0%, #0ea5e9 100%);
      --glass-bg: rgba(255, 255, 255, 0.9);
      --glow-color: rgba(251, 191, 36, 0.15);
      --particle-color: #f59e0b;

      --button-hover: #020617;
      --button-glow: rgba(251, 191, 36, 0.3);
    }

    .theme-happy .story-header {
      background: var(--header-gradient) !important;
      animation: happy-shimmer 6s infinite alternate;
      border-bottom: 4px solid var(--secondary-color);
    }

    /* Disable dark global meshes for Happy theme */
    .theme-happy::before,
    .theme-happy::after,
    .theme-happy footer::before {
      display: none !important;
    }

    .theme-happy {
      background-image: none !important;
    }

    .theme-happy .story-title {
      color: #020617 !important;
      background: none !important;
      -webkit-text-fill-color: initial !important;
      text-shadow: none !important;
    }

    /* Floating Happiness Bubbles Effect (Near Invisible for Stability) */
    @keyframes happy-shimmer {
      0% {
        box-shadow: 0 5px 15px rgba(251, 191, 36, 0.1);
      }

      100% {
        box-shadow: 0 15px 35px rgba(14, 165, 233, 0.2);
      }
    }

    .theme-happy::after {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image:
        radial-gradient(circle at 10% 10%, rgba(251, 191, 36, 0.04) 0%, transparent 15%),
        radial-gradient(circle at 90% 20%, rgba(14, 165, 233, 0.04) 0%, transparent 20%),
        radial-gradient(circle at 30% 80%, rgba(251, 191, 36, 0.04) 0%, transparent 18%);
      pointer-events: none;
      z-index: -1;
      animation: bubble-float 25s infinite linear;
    }

    @keyframes bubble-float {
      0% {
        background-position: 0 0;
      }

      100% {
        background-position: 100px 100px;
      }
    }

    /* Sad: "Midnight Melancholy" - Atmospheric, Somber, Immersive */
    .theme-sad {
      --primary-color: #1e293b;
      /* Slate 800 */
      --secondary-color: #64748b;
      /* Slate 500 */
      --accent-color: #0f172a;
      /* Slate 900 */

      --background-color: #0a0f18;
      /* Deep Midnight Slate */
      --card-background: rgba(15, 23, 42, 0.95);

      --text-color: #94a3b8;
      /* Somber Slate Gray */
      --text-muted: #475569;
      /* Slate 600 */
      --border-color: rgba(148, 163, 184, 0.1);

      --header-gradient: linear-gradient(to bottom, #0f172a 0%, #0a0f18 100%);
      --glass-bg: rgba(10, 15, 24, 0.8);
      --glow-color: rgba(30, 41, 59, 0.3);
      --particle-color: #475569;

      --button-hover: #0f172a;
      --button-glow: rgba(15, 23, 42, 0.4);
    }

    .theme-sad .story-main,
    .theme-sad .action-card,
    .theme-sad .story-image {
      filter: grayscale(0.4) contrast(0.9);
      transition: filter 0.5s ease;
    }

    .theme-sad .story-main:hover {
      filter: grayscale(0.2) contrast(1);
    }

    /* Falling Rain Animation */
    .theme-sad::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url('https://raw.githubusercontent.com/PavelDoGreat/WebGL-Fluid-Simulation/master/logo/rain.png');
      background-repeat: repeat;
      opacity: 0.15;
      pointer-events: none;
      z-index: 10;
      animation: rain-fall 0.5s linear infinite;
    }

    @keyframes rain-fall {
      0% {
        background-position: 0 0;
      }

      100% {
        background-position: 20px 100px;
      }
    }

    .theme-melancholy {
      --primary-color: #57534e;
      /* Stone 600 */
      --secondary-color: #a8a29e;
      /* Stone 400 */
      --accent-color: #292524;
      /* Stone 900 */

      --background-color: #fafaf9;
      /* Stone 50 */
      --card-background: rgba(255, 255, 255, 0.9);

      --text-color: #44403c;
      /* Stone 700 */
      --text-muted: #78716c;
      /* Stone 500 */
      --border-color: rgba(87, 83, 78, 0.1);

      --header-gradient: linear-gradient(to bottom, #f5f5f4, #e7e5e4);
      --glass-bg: rgba(255, 255, 255, 0.7);
      --glow-color: rgba(168, 162, 158, 0.15);
      --particle-color: #a8a29e;
    }

    /* Romantic: "Velvet Rose" - Intense, Saturated, Deeply Romantic */
    .theme-romantic {
      --primary-color: #be185d;
      /* Rose 700 */
      --secondary-color: #db2777;
      /* Pink 600 */
      --accent-color: #831843;
      /* Rose 900 */

      --background-color: #f9a8d4;
      /* Saturated Rose Pink (Pink 300) */
      --card-background: #fdf2f8;
      /* Soft Pink Silk (Rose 50) - NO WHITE */

      --text-color: #500724;
      /* Deep Velvet Maroon */
      --text-muted: #831843;
      /* Deep Rose */
      --border-color: rgba(131, 24, 67, 0.3);

      --header-gradient: linear-gradient(135deg, #f9a8d4 0%, #be185d 100%);
      --glass-bg: rgba(253, 242, 248, 0.95);
      --glow-color: rgba(190, 24, 93, 0.5);
      --particle-color: #be185d;

      --button-hover: #831843;
      --button-glow: rgba(190, 24, 93, 0.5);
    }

    .theme-romantic .story-title {
      font-family: 'Playfair Display', serif;
      text-shadow: 0 0 15px rgba(244, 114, 182, 0.2);
    }

    /* Falling Rose Petals Animation */
    .theme-romantic::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image:
        radial-gradient(circle at 10% 10%, rgba(244, 114, 182, 0.08) 0%, transparent 12%),
        radial-gradient(circle at 90% 20%, rgba(251, 113, 133, 0.08) 0%, transparent 15%),
        radial-gradient(circle at 30% 80%, rgba(244, 114, 182, 0.08) 0%, transparent 18%);
      pointer-events: none;
      z-index: -1;
      animation: petal-fall 25s infinite linear;
    }

    @keyframes petal-fall {
      0% {
        background-position: 0 0;
      }

      100% {
        background-position: 150px 300px;
      }
    }

    /* Thriller: "Noir Heartbeat" - Cinematic, Tense, High Contrast */
    .theme-thriller {
      --primary-color: #b91c1c;
      /* Sharp Crimson */
      --secondary-color: #ef4444;
      /* Red 500 */
      --accent-color: #450a0a;
      /* Deep Blood */

      --background-color: #050505;
      /* Pitch Black Noir */
      --card-background: rgba(10, 5, 5, 0.98);

      --text-color: #fca5a5;
      /* Muted Rose/Red */
      --text-muted: #7f1d1d;
      /* Dark Red */
      --border-color: rgba(185, 28, 28, 0.2);

      --header-gradient: linear-gradient(to bottom, #1a0505 0%, #050505 100%);
      --glass-bg: rgba(5, 5, 5, 0.85);
      --glow-color: rgba(185, 28, 28, 0.2);
      --particle-color: #b91c1c;

      --button-hover: #ffffff;
      --button-glow: rgba(185, 28, 28, 0.5);
    }

    /* Heartbeat Pulse Effect */
    .theme-thriller .story-card {
      animation: heart-pulse 2s infinite cubic-bezier(0.4, 0, 0.6, 1);
      border: 1px solid rgba(185, 28, 28, 0.1);
    }

    @keyframes heart-pulse {

      0%,
      100% {
        transform: scale(1);
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
      }

      5% {
        transform: scale(1.005);
        box-shadow: 0 0 30px rgba(185, 28, 28, 0.1);
      }

      10% {
        transform: scale(1);
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
      }

      15% {
        transform: scale(1.01);
        box-shadow: 0 0 35px rgba(185, 28, 28, 0.15);
      }

      20% {
        transform: scale(1);
        box-shadow: 0 0 20px rgba(0, 0, 0, 0.5);
      }
    }

    /* Cinematic Film Grain Overlay */
    .theme-thriller::after {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)'/%3E%3C/svg%3E");
      opacity: 0.04;
      pointer-events: none;
      z-index: 100;
      mix-blend-mode: overlay;
    }

    /* Horror: "Abyss" - Deep, Dark, Immersive */
    .theme-horror {
      --primary-color: #7f1d1d;
      /* Red 900 */
      --secondary-color: #3f0909;
      /* Darker Red */
      --accent-color: #000000;

      --background-color: #000000;
      --card-background: rgba(10, 10, 10, 0.95);

      --text-color: #e5e5e5;
      --text-muted: #991b1b;
      --border-color: rgba(127, 29, 29, 0.3);

      --header-gradient: linear-gradient(to bottom, #111, #000);
      --glass-bg: rgba(0, 0, 0, 0.9);
      --glow-color: rgba(185, 28, 28, 0.6);
      --particle-color: #450a0a;

      --button-hover: #450a0a;
      --button-glow: rgba(153, 27, 27, 0.5);
    }

    /* Adventure: "Forest Expedition" - Natural, Clean, Fresh */
    .theme-adventure {
      --primary-color: #059669;
      /* Emerald 600 */
      --secondary-color: #34d399;
      /* Emerald 400 */
      --accent-color: #064e3b;
      /* Emerald 900 */

      --background-color: #ecfdf5;
      /* Emerald 50 */
      --card-background: rgba(255, 255, 255, 0.9);

      --text-color: #020617;
      /* Absolute Readability (Near Black) */
      --text-muted: #012e23;
      /* Deepest Emerald */
      --border-color: rgba(5, 150, 105, 0.15);

      --header-gradient: linear-gradient(135deg, #f0fdf4 0%, #dcfce7 100%);
      --glass-bg: rgba(255, 255, 255, 0.7);
      --glow-color: rgba(52, 211, 153, 0.25);
      --particle-color: #10b981;

      --button-hover: #047857;
      --button-glow: rgba(5, 150, 105, 0.3);
    }

    /* Mystery: "Midnight Mist" - Enigmatic, Foggy, Deeply Mysterious */
    .theme-mystery {
      --primary-color: #7c3aed;
      /* Shadow Purple */
      --secondary-color: #a78bfa;
      /* Violet 400 */
      --accent-color: #4c1d95;
      /* Deep Violet */

      --background-color: #020617;
      /* Midnight Indigo */
      --card-background: rgba(15, 23, 42, 0.92);

      --text-color: #e2e8f0;
      /* Silver Mist */
      --text-muted: #a78bfa;
      /* Violet Glow */
      --border-color: rgba(124, 58, 237, 0.3);

      --header-gradient: linear-gradient(135deg, #1e1b4b 0%, #020617 100%);
      --glass-bg: rgba(15, 23, 42, 0.85);
      --glow-color: rgba(124, 58, 237, 0.4);
      --particle-color: #8b5cf6;

      --button-hover: #6d28d9;
      --button-glow: rgba(124, 58, 237, 0.5);
    }

    /* Floating Midnight Mist Animation */
    .theme-mystery::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image:
        radial-gradient(ellipse at 20% 30%, rgba(124, 58, 237, 0.08) 0%, transparent 40%),
        radial-gradient(ellipse at 80% 70%, rgba(139, 92, 246, 0.06) 0%, transparent 45%),
        radial-gradient(ellipse at 50% 50%, rgba(76, 29, 149, 0.05) 0%, transparent 50%);
      pointer-events: none;
      z-index: -1;
      animation: mist-float 20s infinite ease-in-out;
    }

    @keyframes mist-float {

      0%,
      100% {
        transform: translate(0, 0) scale(1);
        opacity: 0.6;
      }

      50% {
        transform: translate(30px, -20px) scale(1.1);
        opacity: 0.8;
      }
    }

    /* Fantasy: "Celestial Dreamscape" - Deep, Magical, Starlit */
    .theme-fantasy {
      --primary-color: #8b5cf6;
      /* Royal Purple */
      --secondary-color: #c084fc;
      /* Light Lavender */
      --accent-color: #fcd34d;
      /* Starlight Gold */

      --background-color: #050816;
      /* Deep Midnight Night */
      --card-background: rgba(13, 10, 36, 0.92);
      /* Deep Indigo Crystal */

      --text-color: #f1f5f9;
      /* Starlight White */
      --text-muted: #a78bfa;
      /* Lavender Glow */
      --border-color: rgba(139, 92, 246, 0.3);

      --header-gradient: linear-gradient(135deg, #1e1b4b 0%, #312e81 50%, #1e1b4b 100%);
      --glass-bg: rgba(15, 12, 41, 0.85);
      --glow-color: rgba(139, 92, 246, 0.5);
      --particle-color: #fcd34d;

      --button-hover: #7c3aed;
      --button-glow: rgba(139, 92, 246, 0.6);
    }

    .theme-fantasy .story-title {
      font-family: 'Playfair Display', serif;
      text-shadow: 0 0 15px rgba(139, 92, 246, 0.4), 0 0 30px rgba(192, 132, 252, 0.2);
      background: linear-gradient(to right, #f1f5f9, #fcd34d, #f1f5f9);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-size: 200% auto;
      animation: celestial-shimmer 5s linear infinite;
    }

    @keyframes celestial-shimmer {
      to {
        background-position: 200% center;
      }
    }

    /* Magical Floating Stars & Nebula Aurora */
    .theme-fantasy::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image:
        radial-gradient(circle at 15% 15%, #fcd34d 0.5px, transparent 1px),
        radial-gradient(circle at 85% 25%, #f1f5f9 0.5px, transparent 1px),
        radial-gradient(circle at 40% 70%, #fcd34d 0.5px, transparent 1px),
        radial-gradient(circle at 70% 80%, #f1f5f9 0.5px, transparent 1px),
        radial-gradient(circle at 25% 45%, #fcd34d 0.5px, transparent 1px),
        radial-gradient(circle at 75% 55%, #f1f5f9 0.5px, transparent 1px),
        /* Nebula layers */
        radial-gradient(ellipse at 30% 20%, rgba(139, 92, 246, 0.07) 0%, transparent 50%),
        radial-gradient(ellipse at 70% 80%, rgba(192, 132, 252, 0.05) 0%, transparent 60%);
      pointer-events: none;
      z-index: -1;
      animation: celestial-drift 60s infinite linear;
    }

    @keyframes celestial-drift {
      0% {
        transform: scale(1) translate(0, 0);
      }

      50% {
        transform: scale(1.1) translate(30px, -20px);
      }

      100% {
        transform: scale(1) translate(0, 0);
      }
    }

    /* Crystal Glass Cards for Fantasy */
    .theme-fantasy .action-card,
    .theme-fantasy .story-main {
      border: 1px solid rgba(139, 92, 246, 0.3);
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.4), 0 0 15px rgba(139, 92, 246, 0.1);
    }

    .theme-fantasy .meta-item {
      background: rgba(139, 92, 246, 0.1);
      border-color: rgba(139, 92, 246, 0.2);
    }

    .theme-fantasy .meta-item:hover {
      background: rgba(139, 92, 246, 0.2);
      box-shadow: 0 0 12px rgba(139, 92, 246, 0.3);
    }

    .theme-fantasy .ai-badge {
      background: linear-gradient(135deg, #7c3aed 0%, #fcd34d 100%);
      color: #050816;
      border: none;
      font-weight: 700;
    }

    .theme-fantasy .tag {
      background: rgba(139, 92, 246, 0.15);
      border-left: 3px solid #fcd34d;
    }

    .theme-fantasy .btn {
      border: 1px solid rgba(252, 211, 77, 0.3);
    }

    .theme-fantasy .btn:hover {
      box-shadow: 0 0 25px rgba(139, 92, 246, 0.4), 0 0 10px rgba(252, 211, 77, 0.2);
    }

    /* Sci-Fi: "Cyber Future" - Clean, Tech, Neon */
    .theme-scifi {
      --primary-color: #0891b2;
      /* Cyan 600 */
      --secondary-color: #22d3ee;
      /* Cyan 400 */
      --accent-color: #164e63;
      /* Cyan 900 */

      --background-color: #083344;
      /* Cyan 950 */
      --card-background: rgba(8, 51, 68, 0.95);

      --text-color: #ecfeff;
      /* Cyan 50 */
      --text-muted: #67e8f9;
      /* Cyan 300 */
      --border-color: rgba(34, 211, 238, 0.3);

      --header-gradient: linear-gradient(135deg, #164e63 0%, #083344 100%);
      --glass-bg: rgba(8, 51, 68, 0.8);
      --glow-color: rgba(6, 182, 212, 0.5);
      --particle-color: #06b6d4;

      --button-hover: #0e7490;
      --button-glow: rgba(34, 211, 238, 0.6);
    }

    /* Inspirational: "Success Gold" - Professional, Bright */
    .theme-inspirational {
      --primary-color: #d97706;
      /* Amber 600 */
      --secondary-color: #fbbf24;
      /* Amber 400 */
      --accent-color: #b45309;
      /* Amber 700 */

      --background-color: #fffbef;
      /* Amber 50 (light) */
      --card-background: rgba(255, 255, 255, 0.95);

      --text-color: #020617;
      /* Absolute Readability (Near Black) */
      --text-muted: #451a03;
      /* Dark Amber */
      --border-color: rgba(217, 119, 6, 0.2);

      --header-gradient: linear-gradient(135deg, #fffbeb 0%, #fef3c7 100%);
      --glass-bg: rgba(255, 255, 255, 0.7);
      --glow-color: rgba(245, 158, 11, 0.3);
      --particle-color: #fbbf24;

      --button-hover: #b45309;
      --button-glow: rgba(245, 158, 11, 0.4);
    }

    /* Comedy: "Golden Sunshine" - Bold, Vibrant, Playful */
    .theme-comedy {
      --primary-color: #f59e0b;
      /* Amber 500 */
      --secondary-color: #fbbf24;
      /* Amber 400 */
      --accent-color: #d97706;
      /* Amber 600 */

      --background-color: #fcd34d;
      /* Bold Golden Yellow (Amber 300) */
      --card-background: #fef3c7;
      /* Soft Cream Yellow (Amber 100) - NO WHITE */

      --text-color: #020617;
      /* Absolute Readability (Near Black) */
      --text-muted: #78350f;
      /* Deep Amber */
      --border-color: rgba(217, 119, 6, 0.3);

      --header-gradient: linear-gradient(135deg, #fcd34d 0%, #fbbf24 100%);
      --glass-bg: rgba(254, 243, 199, 0.95);
      --glow-color: rgba(245, 158, 11, 0.6);
      --particle-color: #fbbf24;

      --button-hover: #d97706;
      --button-glow: rgba(245, 158, 11, 0.5);
    }

    /* Bouncing Confetti Animation */
    .theme-comedy::before {
      content: "";
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background-image:
        radial-gradient(circle at 15% 20%, #f59e0b 0%, transparent 3%),
        radial-gradient(circle at 85% 30%, #fb923c 0%, transparent 3%),
        radial-gradient(circle at 45% 10%, #fbbf24 0%, transparent 3%),
        radial-gradient(circle at 70% 50%, #f59e0b 0%, transparent 3%),
        radial-gradient(circle at 25% 70%, #fb923c 0%, transparent 3%),
        radial-gradient(circle at 90% 80%, #fbbf24 0%, transparent 3%);
      pointer-events: none;
      z-index: -1;
      animation: confetti-bounce 3s infinite ease-in-out;
    }

    @keyframes confetti-bounce {

      0%,
      100% {
        transform: translateY(0) rotate(0deg);
        opacity: 0.7;
      }

      25% {
        transform: translateY(-15px) rotate(5deg);
        opacity: 0.9;
      }

      50% {
        transform: translateY(0) rotate(-5deg);
        opacity: 0.8;
      }

      75% {
        transform: translateY(-10px) rotate(3deg);
        opacity: 0.9;
      }
    }

    /* Playful Story Card Bounce */
    .theme-comedy .story-card {
      animation: card-bounce 4s infinite ease-in-out;
    }

    @keyframes card-bounce {

      0%,
      100% {
        transform: translateY(0);
      }

      50% {
        transform: translateY(-5px);
      }
    }

    /* Comedy Theme Badge Styling */
    .theme-comedy .meta-item {
      background: rgba(217, 119, 6, 0.15);
      border-color: rgba(217, 119, 6, 0.3);
      color: #78350f;
    }

    .theme-comedy .meta-item:hover {
      background: rgba(217, 119, 6, 0.25);
      border-color: rgba(217, 119, 6, 0.5);
      transform: translateY(-2px) scale(1.05);
    }

    .theme-comedy .meta-item i {
      color: #f59e0b;
    }

    .theme-comedy .ai-badge {
      background: linear-gradient(135deg, #f59e0b 0%, #fbbf24 100%);
      color: #020617;
      border: 2px solid #d97706;
    }
  </style>
</head>

<body class="{{ theme_class }}">
  <a href="{% url 'authentication:home' %}" class="home-btn">
    <i class="fas fa-home"></i> Home
  </a>
  <div class="story-container">

    <div class="story-main">

      <div class="story-header">
        <h1 class="story-title">{{ story.title }}</h1>
        <div class="story-author">
          By <a href="/Mystory/author/{{ story.user.username }}/">{{ story.user.username }}</a>
        </div>


        {% if story.is_ai_generated %}
        <span class="badge ai-badge">AI Created</span>
        {% endif %}

        <div class="story-meta">
          <div class="meta-item">
            <i class="fas fa-clock"></i>
            <span>{{ story.get_length_display }}</span>
          </div>
          <div class="meta-item">
            <i class="fas fa-eye"></i>
            <span>{{ view_count }} views</span>
          </div>
          <div class="meta-item">
            <i class="fas fa-heart"></i>
            <span>{{ like_count }} likes</span>
          </div>
          <div class="meta-item">
            <i class="fas fa-calendar"></i>
            <span>{{ story.created_at|date:"M d, Y" }}</span>
          </div>
        </div>
      </div>

      {% if story.image %}
      <img src="{{ story.image.url }}" alt="{{ story.title }}" class="story-image">
      {% endif %}
      <div class="translation-box">
        <form method="post" action="{% url 'aistory:translate_story' story.id %}" class="translation-form">
          {% csrf_token %}
          <label for="language">Translate Story:</label>
          <div class="select-wrapper">
            <select class="select-language" name="language" id="language">
              <option value="en">English</option>
              <option value="af">Afrikaans</option>
              <option value="sq">Albanian</option>
              <option value="am">Amharic</option>
              <option value="ar">Arabic</option>
              <option value="hy">Armenian</option>
              <option value="az">Azerbaijani</option>
              <option value="eu">Basque</option>
              <option value="be">Belarusian</option>
              <option value="bn">Bengali</option>
              <option value="bs">Bosnian</option>
              <option value="bg">Bulgarian</option>
              <option value="ca">Catalan</option>
              <option value="ceb">Cebuano</option>
              <option value="ny">Chichewa</option>
              <option value="zh-cn">Chinese (Simplified)</option>
              <option value="zh-tw">Chinese (Traditional)</option>
              <option value="co">Corsican</option>
              <option value="hr">Croatian</option>
              <option value="cs">Czech</option>
              <option value="da">Danish</option>
              <option value="nl">Dutch</option>
              <option value="en">English</option>
              <option value="eo">Esperanto</option>
              <option value="et">Estonian</option>
              <option value="tl">Filipino</option>
              <option value="fi">Finnish</option>
              <option value="fr">French</option>
              <option value="fy">Frisian</option>
              <option value="gl">Galician</option>
              <option value="ka">Georgian</option>
              <option value="de">German</option>
              <option value="el">Greek</option>
              <option value="gu">Gujarati</option>
              <option value="ht">Haitian Creole</option>
              <option value="ha">Hausa</option>
              <option value="haw">Hawaiian</option>
              <option value="iw">Hebrew</option>
              <option value="hi">Hindi</option>
              <option value="hmn">Hmong</option>
              <option value="hu">Hungarian</option>
              <option value="is">Icelandic</option>
              <option value="ig">Igbo</option>
              <option value="id">Indonesian</option>
              <option value="ga">Irish</option>
              <option value="it">Italian</option>
              <option value="ja">Japanese</option>
              <option value="jw">Javanese</option>
              <option value="kn">Kannada</option>
              <option value="kk">Kazakh</option>
              <option value="km">Khmer</option>
              <option value="ko">Korean</option>
              <option value="ku">Kurdish (Kurmanji)</option>
              <option value="ky">Kyrgyz</option>
              <option value="lo">Lao</option>
              <option value="la">Latin</option>
              <option value="lv">Latvian</option>
              <option value="lt">Lithuanian</option>
              <option value="lb">Luxembourgish</option>
              <option value="mk">Macedonian</option>
              <option value="mg">Malagasy</option>
              <option value="ms">Malay</option>
              <option value="ml">Malayalam</option>
              <option value="mt">Maltese</option>
              <option value="mi">Maori</option>
              <option value="mr">Marathi</option>
              <option value="mn">Mongolian</option>
              <option value="my">Myanmar (Burmese)</option>
              <option value="ne">Nepali</option>
              <option value="no">Norwegian</option>
              <option value="ps">Pashto</option>
              <option value="fa">Persian</option>
              <option value="pl">Polish</option>
              <option value="pt">Portuguese</option>
              <option value="pa">Punjabi</option>
              <option value="ro">Romanian</option>
              <option value="ru">Russian</option>
              <option value="sm">Samoan</option>
              <option value="gd">Scots Gaelic</option>
              <option value="sr">Serbian</option>
              <option value="st">Sesotho</option>
              <option value="sn">Shona</option>
              <option value="sd">Sindhi</option>
              <option value="si">Sinhala</option>
              <option value="sk">Slovak</option>
              <option value="sl">Slovenian</option>
              <option value="so">Somali</option>
              <option value="es">Spanish</option>
              <option value="su">Sundanese</option>
              <option value="sw">Swahili</option>
              <option value="sv">Swedish</option>
              <option value="tg">Tajik</option>
              <option value="ta">Tamil</option>
              <option value="te">Telugu</option>
              <option value="th">Thai</option>
              <option value="tr">Turkish</option>
              <option value="uk">Ukrainian</option>
              <option value="ur">Urdu</option>
              <option value="uz">Uzbek</option>
              <option value="vi">Vietnamese</option>
              <option value="cy">Welsh</option>
              <option value="xh">Xhosa</option>
              <option value="yi">Yiddish</option>
              <option value="yo">Yoruba</option>
              <option value="zu">Zulu</option>
            </select>
          </div>
          <button type="submit" class="translate-submit-btn">
            <i class="fas fa-language"></i> Translate
          </button>
        </form>
        <div id="language-support-notification" style="display: none;">
          <i class="fas fa-exclamation-triangle"></i>
          <p>
            <strong>Note:</strong> <span id="notification-message">Text-to-speech may have limited support for this
              language.</span>
          </p>
        </div>
      </div>

      <div id="loaderOverlay" style="
      position: fixed;
      top: 0; left: 0;
      width: 100%;
      height: 100%;
      background-color: #fff;
      z-index: 9999;
      display: flex;
      align-items: center;
      justify-content: center;
      flex-direction: column;
  ">
        <div
          style="border: 5px solid #eee; border-top: 5px solid #1e90ff; border-radius: 50%; width: 60px; height: 60px; animation: spin 1s linear infinite;">
        </div>
        <p style="margin-top: 20px; font-family: sans-serif; color: #333;">Loading your magical story...</p>
      </div>

      <div class="story-content">
        {% if translated_content %}
        <hr>
        <h2>Translated Content ({{ language }})</h2>
        <p id="story-text">{{ translated_content }}</p>
        <button type="button" class="volume-btn" id="volume-btn" style="margin-left: 10px; display: none;"></button>

        {% else %}
        <p id="story-text">{{ story.content|linebreaks }}</p>
        {% endif %}
      </div>
    </div>

    <div class="story-sidebar">
      <div class="action-card">
        <div class="card-header">Story Actions</div>
        <div class="card-content">
          <a style="text-decoration: none;" href="{% url 'mystory:download_story' story.id %}" class="btn download-btn">
            <i class="fas fa-download"></i> Download Story
          </a>
          <a style="text-decoration: none;" href="{% url 'mystory:share_story' story.id %}" class="btn share-btn">
            <i class="fas fa-share-alt"></i> Share Story
          </a>
          <a style="text-decoration: none;" href="{% url 'aistory:like_story' story.id %}" class="btn like-btn">
            {% if is_liked %}
            <i class="fas fa-heart text-red-500"></i> Liked
            {% else %}
            <i class="far fa-heart"></i> Like Story
            {% endif %}
          </a>


        </div>
      </div>
      <div class="story-sidebar">
        <div class="action-card">
          <div class="card-header">Comments</div>
          <div class="">

            <div class="comments-section">

              {% for comment in comments %}
              <div class="comment-item">
                <div class="comment-header">
                  <a class="comment-author" href="/Mystory/author/{{ comment.user.username }}/">
                    {{ comment.user.username|cut:"@gmail.com" }}
                  </a>
                  <span class="comment-date">{{ comment.created_at|date:"F j, Y" }}</span>
                </div>
                <div style="display: flex; justify-content: space-between; align-items: flex-start;">
                  <p class="comment-content">{{ comment.content }}</p>
                  {% if user == comment.user %}
                  <form method="post" action="{% url 'aistory:delete_comment' comment.id %}">
                    {% csrf_token %}
                    <button type="submit" class="delete-comment-btn" title="Delete">
                      <i class="fas fa-trash-alt"></i>
                    </button>
                  </form>
                  {% endif %}
                </div>
              </div>


              {% empty %}
              <p>No comments yet. Be the first!</p>
              {% endfor %}
            </div>

            {% if user.is_authenticated %}
            <form method="post" action="{% url 'aistory:view_story' story.id %}" class="comment-form"
              style="background-color: var(--card-background); padding: 1rem; border-radius: 8px; box-shadow: var(--shadow);">
              {% csrf_token %}
              <textarea name="content" rows="3" placeholder="Write a comment..."
                style="width: 100%; padding: 10px; border-radius: 6px;  border: 1px solid #333;"></textarea>
              <br><br>
              <button type="submit" class="btn action-btn joker-purple">Post Comment</button>
            </form>
            {% else %}
            <p><a href="{% url 'authentication:login' %}" style="color: var(--joker-green);">Login</a> to comment.</p>
            {% endif %}


            </a>



          </div>

          <div class="action-card">
            <div class="card-header">Story Information</div>
            <div class="card-content story-info-card">
              <div class="info-item">
                <div class="info-icon">
                  <i class="fas fa-book"></i>
                </div>
                <div>
                  <div class="info-label">Theme</div>
                  <div>{{ story.theme|title }}</div>
                </div>
              </div>

              <div class="info-item">
                <div class="info-icon">
                  <i class="fas fa-heart"></i>
                </div>
                <div>
                  <div class="info-label">Emotions</div>
                  <div class="tags-container">
                    {% for emotion in emotions_list %}
                    <span class="tag">{{ emotion|title }}</span>
                    {% endfor %}
                  </div>
                </div>
              </div>

              <div class="info-item">
                <div class="info-icon">
                  <i class="fas fa-users"></i>
                </div>
                <div>
                  <div class="info-label">Collaboration</div>
                  <div>
                    {% if story.is_collaborated %}
                    Collaborative
                    {% if collaborators %}
                    <br>
                    <strong>Collaborated with:</strong>
                    <ul>
                      {% for user in collaborators %}
                      <a style="text-decoration: none;" href="/Mystory/author/{{  user.username }}/">
                        <li>{{ user.username }}</li>
                      </a>
                      {% endfor %}
                    </ul>
                    {% endif %}
                    {% else %}
                    Individual
                    {% endif %}
                  </div>

                </div>
              </div>
            </div>
          </div>

          <div class="action-card">
            <div class="card-header">Similar Stories</div>
            <div class="card-content">
              <div class="similar-stories">
                {% for story in similar_stories %}
                <a style="text-decoration: none;  " href="{% url 'aistory:view_story' story.id %}"
                  class="similar-story">
                  {% if story.image %}
                  <img src="{{ story.image.url }}" alt="{{ story.title }}" class="similar-story-img">
                  {% else %}
                  <img src='static/images/logo4.webp' alt="{{ story.title }}" class="similar-story-img">
                  {% endif %}
                  <div class="similar-story-title">{{ story.title }}</div>
                </a>
                {% endfor %}
              </div>
            </div>
          </div>
        </div>
      </div>



      <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

      <!-- JS for Select2 -->
      <script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>

      <script>

        window.addEventListener('load', function () {
          const loader = document.getElementById('loaderOverlay');
          loader.style.display = 'none';
        });
        $(document).ready(function () {
          $('.select-language').select2({
            placeholder: "Select a language",
            allowClear: true
          });
        });


        document.addEventListener("DOMContentLoaded", () => {
          const volumeBtn = document.getElementById("volume-btn");
          const languageSelect = document.getElementById("language");
          let isSpeaking = false;
          const synth = window.speechSynthesis;
          let utterance;

          // Get available voices
          function getVoices() {
            return synth.getVoices();
          }


          const languageFallbackMap = {
            'ar': 'en-US',    // Arabic falls back to English
            'fa': 'en-US',    // Persian falls back to English
            'ur': 'en-US',    // Urdu falls back to English

          };

          function isLanguageDirectlySupported(langCode) {
            const voices = getVoices();
            return voices.some(voice => voice.lang.toLowerCase().includes(langCode.toLowerCase()));
          }

          function findBestVoice(langCode) {
            const voices = getVoices();

            let matchingVoice = voices.find(voice =>
              voice.lang.toLowerCase().startsWith(langCode.toLowerCase())
            );

            if (!matchingVoice && languageFallbackMap[langCode]) {
              const fallbackCode = languageFallbackMap[langCode];
              matchingVoice = voices.find(voice =>
                voice.lang.toLowerCase().startsWith(fallbackCode.toLowerCase())
              );
            }

            if (!matchingVoice) {
              matchingVoice = voices.find(voice => voice.name.includes('Google')) || voices[0];
            }

            return matchingVoice;
          }

          function updateVolumeButton() {
            if (!volumeBtn) return; // Guard against null

            const selectedLang = languageSelect?.value || "en";

            volumeBtn.style.display = "inline-block";

            if (!isLanguageDirectlySupported(selectedLang)) {
              volumeBtn.title = "Limited support for this language";
              volumeBtn.classList.add("limited-support");
              volumeBtn.innerHTML = " ";
            } else {
              volumeBtn.title = "Read aloud";
              volumeBtn.classList.remove("limited-support");
              volumeBtn.innerHTML = "";
            }
          }


          if (typeof speechSynthesis !== "undefined" && speechSynthesis.onvoiceschanged !== undefined) {
            speechSynthesis.onvoiceschanged = updateVolumeButton;
          }


          setTimeout(updateVolumeButton, 1000);


          volumeBtn.addEventListener("click", () => {

            const storyText = document.getElementById("story-text")?.innerText;

            if (!storyText) {
              console.log("No story text found");
              return;
            }

            if (!isSpeaking) {
              try {

                synth.cancel();


                utterance = new SpeechSynthesisUtterance(storyText);


                const selectedLang = languageSelect?.value || "en";
                utterance.lang = selectedLang;


                const bestVoice = findBestVoice(selectedLang);
                if (bestVoice) {
                  console.log(`Using voice: ${bestVoice.name} (${bestVoice.lang}) for ${selectedLang}`);
                  utterance.voice = bestVoice;
                }


                utterance.rate = 0.9;  // Slightly slower
                utterance.pitch = 1.0; // Normal pitch


                utterance.onend = () => {
                  isSpeaking = false;
                  updateVolumeButtonState(false);
                };

                // Handle errors
                utterance.onerror = (event) => {
                  console.error("Speech synthesis error:", event);
                  isSpeaking = false;
                  updateVolumeButtonState(false);
                };


                synth.speak(utterance);
                isSpeaking = true;
                updateVolumeButtonState(true);
              } catch (error) {
                console.error("Error starting speech synthesis:", error);
                isSpeaking = false;
                updateVolumeButtonState(false);
              }
            } else {
              synth.cancel();
              isSpeaking = false;
              updateVolumeButtonState(false);
            }
          });


          function updateVolumeButtonState(speaking) {
            if (speaking) {
              volumeBtn.innerHTML = "";
              volumeBtn.classList.add("speaking");
            } else {
              const selectedLang = languageSelect?.value || "en";
              if (!isLanguageDirectlySupported(selectedLang)) {
                volumeBtn.innerHTML = " ";
              } else {
                volumeBtn.innerHTML = "";
              }
              volumeBtn.classList.remove("speaking");
            }
          }


          if (languageSelect) {
            languageSelect.addEventListener("change", () => {

              if (isSpeaking) {
                synth.cancel();
                isSpeaking = false;
              }

              updateVolumeButton();
            });
          }


          console.log("Available voices:", getVoices().map((v, i) => `${i}: "${v.name} (${v.lang})"`));
        });
        function updateLanguageSupportNotification() {
          const selectedLang = document.getElementById("language")?.value || "en";
          const notification = document.getElementById("language-support-notification");
          const message = document.getElementById("notification-message");


          const isSupported = isLanguageDirectlySupported(selectedLang);

          if (!isSupported) {
            const langName = document.querySelector(`#language option[value="${selectedLang}"]`)?.textContent || selectedLang;
            message.textContent = `Text-to-speech has limited support for ${langName}. Some text may not be read correctly.`;
            notification.style.display = "block";
          } else {
            notification.style.display = "none";
          }
        }


        if (languageSelect) {
          languageSelect.addEventListener("change", updateLanguageSupportNotification);
        }


        setTimeout(updateLanguageSupportNotification, 1000);



      </script>
      <script>

        class ThemeAudioSystem {
          constructor() {
            this.bgMusic = null;
            this.sfxAudio = [];
            this.currentTheme = null;
            this.musicVolume = 0.4;
            this.sfxVolume = 0.4;
            this.isMusicMuted = false;
            this.isSFXMuted = false;
            this.isPlaying = false;

            this.audioLibrary = {
              happy: {
                bg: '/static/audio/happy.mp3',
                sfx: [
                  'https://assets.mixkit.co/active_storage/sfx/2016/2016-preview.mp3', // Fairy arcade sparkle
                  'https://assets.mixkit.co/active_storage/sfx/1113/1113-preview.mp3', // Sunny pop
                  'https://assets.mixkit.co/active_storage/sfx/1435/1435-preview.mp3'  // Magical bell
                ]
              }

              , sad: {
                bg: '/static/audio/sad.mp3',
                sfx: [
                  'https://assets.mixkit.co/active_storage/sfx/170/170-preview.mp3',
                  'https://assets.mixkit.co/active_storage/sfx/171/171-preview.mp3',
                  'https://assets.mixkit.co/active_storage/sfx/172/172-preview.mp3'
                ]
              },

              romantic: {
                bg: '/static/audio/romantic2.mp3', // Gentle piano melody
                sfx: [
                  '/static/audio/romantic3.mp3',   // Harp sparkle 1
                ]
              },
              thriller: {
                bg: '/static/audio/thriller.mp3',
                sfx: [
                  'https://assets.mixkit.co/active_storage/sfx/2592/2592-preview.mp3', // Cinematic hit 1
                  'https://assets.mixkit.co/active_storage/sfx/2593/2593-preview.mp3', // Cinematic hit 2
                  'https://assets.mixkit.co/active_storage/sfx/2594/2594-preview.mp3'  // Cinematic hit 3
                ]
              },
              adventure: {
                bg: '/static/audio/adventure.mp3',
                sfx: [
                  'https://cdn.pixabay.com/download/audio/2022/07/27/audio_6f7g8h9i0j.mp3?filename=sword-clash-109400.mp3'
                ]
              },
              mystery: {
                bg: '/static/audio/mystry.mp3', // Enigmatic ambient soundscape
                sfx: [
                  '/static/audio/mystry1.mp3',
                  '/static/audio/mystry2.mp3'
                ]
              },
              fantasy: {
                bg: '/static/audio/fantacy.mp3',
                sfx: [
                  '/static/audio/fantacy1.mp3'
                ]
              },
              scifi: {
                bg: '/static/audio/scifi.mp3',
                sfx: [
                  'https://cdn.pixabay.com/download/audio/2022/09/14/audio_5d6e7f8g9h.mp3?filename=laser-shot-105331.mp3'
                ]
              },
              horror: {
                bg: '/static/audio/horror.mp3',
                sfx: [
                  '/static/audio/horror1.mp3'
                ]
              },
              comedy: {
                bg: '/static/audio/comedy.mp3',
                sfx: [
                  'https://cdn.pixabay.com/download/audio/2022/10/31/audio_1s2t3u4v5w.mp3?filename=scream-horror-108678.mp3'
                ]
              },
              inspirational: {
                bg: '/static/audio/inspare.mp3',
                sfx: [
                  'https://cdn.pixabay.com/download/audio/2022/06/15/audio_8m9n0o1p2q.mp3?filename=success-fanfare-102345.mp3'
                ]
              },
              melancholy: {
                bg: '/static/audio/melancholy.mp3',
                sfx: [
                  'https://cdn.pixabay.com/download/audio/2022/06/15/audio_8m9n0o1p2q.mp3?filename=success-fanfare-102345.mp3'
                ]
              },
              anger: {
                bg: '/static/audio/anger.mp3',
                sfx: [
                  'https://cdn.pixabay.com/download/audio/2022/06/15/audio_8m9n0o1p2q.mp3?filename=success-fanfare-102345.mp3'
                ]
              },
              surprise: {
                bg: '/static/audio/surpraise.mp3',
                sfx: [
                  'https://cdn.pixabay.com/download/audio/2022/06/15/audio_8m9n0o1p2q.mp3?filename=success-fanfare-102345.mp3'
                ]
              },
              fear: {
                bg: '/static/audio/fear.mp3',
                sfx: [
                  'https://cdn.pixabay.com/download/audio/2022/06/15/audio_8m9n0o1p2q.mp3?filename=success-fanfare-102345.mp3'
                ]
              },
            };

            this.init();
          }

          init() {
            this.createAudioControls();
            this.detectAndLoadTheme();
            this.setupEventListeners();
          }

          createAudioControls() {
            const controlsHTML = `
      <style>
        .audio-controls {
          position: fixed;
          bottom: 25px;
          right: 25px;
          background: var(--glass-bg);
          backdrop-filter: blur(15px);
          padding: 15px 20px;
          border-radius: 16px;
          display: flex;
          flex-direction: column;
          gap: 12px;
          min-width: 280px;
          box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
          border: 1px solid var(--border-color);
          z-index: 1000;
          transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .audio-controls:hover {
          transform: translateY(-5px);
          box-shadow: 0 12px 40px rgba(0, 0, 0, 0.2);
        }

        .audio-controls-row {
          display: flex;
          gap: 15px;
          align-items: center;
        }

        .audio-btn {
          background: rgba(255, 255, 255, 0.1);
          border: 1px solid rgba(255, 255, 255, 0.1);
          width: 44px;
          height: 44px;
          border-radius: 50%;
          cursor: pointer;
          font-size: 20px;
          display: flex;
          align-items: center;
          justify-content: center;
          transition: all 0.3s ease;
          position: relative;
          color: var(--text-color);
          flex-shrink: 0;
        }

        .audio-btn:hover {
          background: var(--primary-color);
          color: white;
          transform: scale(1.1) rotate(10deg);
        }

        .audio-indicator {
          position: absolute;
          top: 0;
          right: 0;
          width: 10px;
          height: 10px;
          background: var(--secondary-color);
          border-radius: 50%;
          border: 2px solid var(--glass-bg);
          animation: pulse 1.5s infinite;
        }

        .volume-control {
          display: flex;
          align-items: center;
          gap: 8px;
          flex: 1;
        }

        .volume-label {
          color: var(--text-muted);
          font-size: 12px;
          font-weight: 600;
          min-width: 50px;
        }

        .volume-slider {
          flex: 1;
          height: 6px;
          background: rgba(0, 0, 0, 0.1);
          border-radius: 3px;
          outline: none;
          cursor: pointer;
          -webkit-appearance: none;
        }

        .volume-slider::-webkit-slider-thumb {
          -webkit-appearance: none;
          width: 16px;
          height: 16px;
          background: var(--primary-color);
          border-radius: 50%;
          cursor: pointer;
          box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
          transition: transform 0.2s;
        }

        .volume-slider::-webkit-slider-thumb:hover {
          transform: scale(1.2);
        }

        .volume-slider::-moz-range-thumb {
          width: 16px;
          height: 16px;
          background: var(--primary-color);
          border-radius: 50%;
          cursor: pointer;
          border: none;
          box-shadow: 0 2px 6px rgba(0, 0, 0, 0.2);
        }

        .volume-level {
          color: var(--text-color);
          font-size: 12px;
          font-weight: 600;
          min-width: 35px;
          text-align: right;
        }

        .volume-divider {
          height: 1px;
          background: var(--border-color);
          margin: 4px 0;
        }

        @keyframes pulse {
          0%, 100% { opacity: 1; transform: scale(1); }
          50% { opacity: 0.6; transform: scale(1.3); }
        }
      </style>
      <div class="audio-controls">
        <div class="audio-controls-row">
          <button class="audio-btn" id="musicToggle" title="Toggle Music">
            <span id="musicIcon"></span>
            <span class="audio-indicator" id="musicIndicator" style="display: none;"></span>
          </button>
          <button class="audio-btn" id="sfxToggle" title="Toggle Sound SFX">
            <span id="sfxIcon"></span>
            <span class="audio-indicator" id="sfxIndicator" style="display: none;"></span>
          </button>
        </div>
        <div class="volume-divider"></div>
        <div class="volume-control">
          <span class="volume-label"> Music</span>
          <input type="range" class="volume-slider" id="musicVolumeSlider" min="0" max="100" value="40">
          <span class="volume-level" id="musicVolumeLevel">40%</span>
        </div>
        <div class="volume-control">
          <span class="volume-label"> SFX</span>
          <input type="range" class="volume-slider" id="sfxVolumeSlider" min="0" max="100" value="40">
          <span class="volume-level" id="sfxVolumeLevel">40%</span>
        </div>
      </div>
    `;
            document.body.insertAdjacentHTML('beforeend', controlsHTML);
          }

          detectAndLoadTheme() {
            // Detect theme from body class
            const bodyClasses = document.body.className.split(' ');
            const themeClass = bodyClasses.find(cls => cls.startsWith('theme-'));

            if (themeClass) {
              const theme = themeClass.replace('theme-', '');
              this.loadThemeAudio(theme);
            } else {
              console.log('No theme detected');
            }
          }

          loadThemeAudio(theme) {
            if (!this.audioLibrary[theme]) {
              console.log(`No audio for theme: ${theme}`);
              return;
            }

            this.currentTheme = theme;
            const themeAudio = this.audioLibrary[theme];

            // Load background music
            if (this.bgMusic) {
              this.bgMusic.pause();
              this.bgMusic = null;
            }

            this.bgMusic = new Audio(themeAudio.bg);
            this.bgMusic.loop = true;
            this.bgMusic.volume = this.musicVolume;

            // Load sound effects
            this.sfxAudio = themeAudio.sfx.map(url => {
              const audio = new Audio(url);
              audio.volume = this.sfxVolume;
              return audio;
            });

            console.log(`Loaded audio for theme: ${theme}`);
            console.log(`SFX count: ${this.sfxAudio.length}`);
            console.log(`Initial SFX volume: ${this.sfxVolume}`);
          }

          setupEventListeners() {
            const musicToggle = document.getElementById('musicToggle');
            const sfxToggle = document.getElementById('sfxToggle');
            const musicVolumeSlider = document.getElementById('musicVolumeSlider');
            const sfxVolumeSlider = document.getElementById('sfxVolumeSlider');
            const musicVolumeLevel = document.getElementById('musicVolumeLevel');
            const sfxVolumeLevel = document.getElementById('sfxVolumeLevel');

            if (musicToggle) {
              musicToggle.addEventListener('click', () => this.toggleMusic());
            }

            if (sfxToggle) {
              sfxToggle.addEventListener('click', () => this.toggleSFX());
            }

            if (musicVolumeSlider) {
              musicVolumeSlider.addEventListener('input', (e) => {
                const value = e.target.value;
                this.setMusicVolume(value / 100);
                if (musicVolumeLevel) {
                  musicVolumeLevel.textContent = `${value}%`;
                }
              });
            }

            if (sfxVolumeSlider) {
              sfxVolumeSlider.addEventListener('input', (e) => {
                const value = e.target.value;
                this.setSFXVolume(value / 100);
                if (sfxVolumeLevel) {
                  sfxVolumeLevel.textContent = `${value}%`;
                }
              });
            }

            // Add SFX triggers to interactive elements
            document.querySelectorAll('.btn, .action-card, .similar-story').forEach(el => {
              el.addEventListener('mouseenter', () => {
                if (Math.random() > 0.7) { // 30% chance
                  this.playRandomSFX();
                }
              });
            });
          }

          toggleMusic() {
            if (!this.bgMusic) {
              console.log('No background music loaded');
              return;
            }

            const icon = document.getElementById('musicIcon');
            const indicator = document.getElementById('musicIndicator');

            if (this.isPlaying) {
              this.bgMusic.pause();
              this.isPlaying = false;
              this.isMusicMuted = true;
              if (icon) icon.textContent = '';
              if (indicator) indicator.style.display = 'none';
              console.log('Music paused');
            } else {
              this.bgMusic.play().then(() => {
                this.isPlaying = true;
                this.isMusicMuted = false;
                if (icon) icon.textContent = '';
                if (indicator) indicator.style.display = 'block';
                console.log('Music playing');
              }).catch(err => {
                console.error('Failed to play music:', err);
              });
            }
          }

          toggleSFX() {
            this.isSFXMuted = !this.isSFXMuted;
            const icon = document.getElementById('sfxIcon');
            const indicator = document.getElementById('sfxIndicator');

            if (icon) icon.textContent = this.isSFXMuted ? '' : '';
            if (indicator) indicator.style.display = this.isSFXMuted ? 'none' : 'block';

            console.log('SFX toggled:', this.isSFXMuted ? 'MUTED' : 'UNMUTED');
          }

          setMusicVolume(level) {
            this.musicVolume = level;
            if (this.bgMusic) {
              this.bgMusic.volume = level;
            }
          }

          setSFXVolume(level) {
            this.sfxVolume = level;
            console.log(` SFX volume changed to: ${(level * 100).toFixed(0)}%`);
            this.sfxAudio.forEach(sfx => {
              sfx.volume = level;
            });
          }

          playRandomSFX() {
            console.log('playRandomSFX called');
            console.log('  - isSFXMuted:', this.isSFXMuted);
            console.log('  - sfxAudio length:', this.sfxAudio?.length);
            console.log('  - sfxVolume:', this.sfxVolume);

            if (this.isSFXMuted) {
              console.log(' SFX is muted, not playing');
              return;
            }

            if (!this.sfxAudio || this.sfxAudio.length === 0) {
              console.log(' No SFX audio loaded');
              return;
            }

            const randomIndex = Math.floor(Math.random() * this.sfxAudio.length);
            const sfx = this.sfxAudio[randomIndex];

            // Reset to beginning and set current volume
            sfx.currentTime = 0;
            sfx.volume = this.sfxVolume;

            console.log(` Playing SFX #${randomIndex} at volume ${(this.sfxVolume * 100).toFixed(0)}%`);
            console.log('  - Source:', sfx.src);
            console.log('  - Volume:', sfx.volume);

            sfx.play().then(() => {
              console.log(' SFX started playing');
            }).catch(err => {
              console.error(' SFX play failed:', err);
            });
          }
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', () => {
          window.themeAudio = new ThemeAudioSystem();

          // Auto-start music on first user interaction
          const startAudio = () => {
            if (window.themeAudio && window.themeAudio.bgMusic && !window.themeAudio.isPlaying) {
              window.themeAudio.toggleMusic();
            }
            document.removeEventListener('click', startAudio);
          };

          document.addEventListener('click', startAudio, { once: true });
        });
      </script>

</body>

</html>